# Template file for 'intel-compute-runtime-bin'
pkgname=intel-compute-runtime-bin
version=21.18.19737
revision=1
archs="x86_64"
depends="intel-graphics-compiler-bin"
short_desc="Intel Graphics Compute Runtime and OpenCL Driver (precompiled binaries)"
maintainer="Lucas L. Treffenst√§dt <lucas@treffenstaedt.de>"
license="MIT"
homepage="https://github.com/intel/compute-runtime/"
_lzver=1.1.19737
_gmmver=21.1.2
distfiles="https://github.com/intel/compute-runtime/releases/download/${version}/intel-opencl_${version}_amd64.deb
 https://github.com/intel/compute-runtime/releases/download/${version}/intel-ocloc_${version}_amd64.deb
 https://github.com/intel/compute-runtime/releases/download/${version}/intel-level-zero-gpu_${_lzver}_amd64.deb"
checksum="a17a4f7f4e2e59096a58e131235c508eb49f9086db5bef3ddb47c5ae482e2bac
 35a851d44b54f4c948e06edf709c4cd509b17029a03bf58b7ae614062880e352
 4bb17c8a23d7a188b6c1194f181d403ef98ea6c0eabf75298feb1fa24c8458f2"
nostrip=yes

do_extract() {
	ar p ${XBPS_SRCDISTDIR}/${pkgname}-${version}/intel-opencl_${version}_amd64.deb \
		data.tar.xz | bsdtar -x -f -
	ar p ${XBPS_SRCDISTDIR}/${pkgname}-${version}/intel-ocloc_${version}_amd64.deb \
		data.tar.xz | bsdtar -x -f -
	ar p ${XBPS_SRCDISTDIR}/${pkgname}-${version}/intel-level-zero-gpu_${_lzver}_amd64.deb \
		data.tar.xz | bsdtar -x -f -
	mkdir -p usr
	mv usr/local/{bin,include,lib} usr
	rm -r usr/local
	ln -s $(find usr/lib -regex '.*libze_intel_gpu.so.[0-9]*' -exec basename {} \;) usr/lib/libze_intel_gpu.so
	sed -i 's|/usr/local|/usr|' "etc/OpenCL/vendors/intel.icd"
}

do_install() {
	vmkdir usr
	vcopy ${wrksrc}/usr/* usr
	vlicense ${FILESDIR}/LICENSE
}
